<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The edge</title>
  <link rel="stylesheet" href="styles/styles.css">
  <style>
    #countdown {
      font-size: 24px;
      font-weight: bold;
      margin-top: 10px;
    }
    #message {
      margin-top: 10px;
    }
    #startButton {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  
  <p>
    As you stand on the edge, you suddenly realise that this is not real.<br>
    None of it is real.<br>
    So, why does he allow you to walk to the edge of the building?<br>
    Wouldn't that be dangerous?<br>
    And so, you decide to jump... because if you can jump, it must be part of the game...<br>
    As soon as you show intend to jump, a platform appears.<br>
    It floats through the air, according to a fixed trajectory.<br>
    Every 10 seconds exactly it passes right in front of you.<br>
    If you time it right, you may be able to jump on the platform...<br>
  </p>
  <div>
    <button id="startButton">Start</button>
    <p id="countdown">10.0</p>
    <button id="stopButton" disabled>Press Exactly at 0.0!</button>
    <p id="message"></p>
  </div>

<script>
  const countdownElement = document.getElementById("countdown");
  const messageElement = document.getElementById("message");
  const stopButton = document.getElementById("stopButton");
  const startButton = document.getElementById("startButton");

  let startTime = null;
  let duration = 10.0; // seconds
  let running = false;
  let rafId = null;

  function updateTimer() {
    const elapsed = (performance.now() - startTime) / 1000;
    const remaining = Math.max(0, duration - elapsed);

    if (remaining > 8) {
      countdownElement.style.visibility = "visible";
      countdownElement.textContent = remaining.toFixed(2);
    } else {
      countdownElement.style.visibility = "hidden";
    }

    // When time runs out, just freeze at 0.00 â€” do NOT disable the stop button
    if (remaining > 0) {
      rafId = requestAnimationFrame(updateTimer);
    } else {
      countdownElement.textContent = "0.00";
      running = false;
    }
  }

  function startGame() {
    if (running) {
      cancelAnimationFrame(rafId);
      resetGame();
      return;
    }

    running = true;
    messageElement.textContent = "";
    startButton.textContent = "Reset";
    stopButton.disabled = false;

    startTime = performance.now();
    countdownElement.textContent = duration.toFixed(2);
    countdownElement.style.visibility = "visible";

    rafId = requestAnimationFrame(updateTimer);
  }

  function stopTimer() {
    if (!startTime) return;

    const elapsed = (performance.now() - startTime) / 1000;
    const diff = duration - elapsed;

    cancelAnimationFrame(rafId);
    running = false;
    stopButton.disabled = true;

    if (Math.abs(diff) < 0.01) {
      fetchSpecialMessage();
    } else if (diff < 0) {
      messageElement.textContent = `Too late by ${(-diff).toFixed(2)} seconds! Try again!`;
    } else {
      messageElement.textContent = `Too early by ${diff.toFixed(2)} seconds! Try again!`;
    }
  }

  function fetchSpecialMessage() {
    fetch("cold.txt")
      .then((res) => res.text())
      .then((text) => (messageElement.textContent = text))
      .catch(() => (messageElement.textContent = "You win! (Message could not be loaded)"));
  }

  function resetGame() {
    cancelAnimationFrame(rafId);
    running = false;
    countdownElement.textContent = "10.00";
    countdownElement.style.visibility = "visible";
    startButton.textContent = "Start";
    messageElement.textContent = "";
    stopButton.disabled = true;
    startTime = null;
  }

  startButton.addEventListener("click", startGame);
  stopButton.addEventListener("click", stopTimer);
</script>


  <p class="white-text">Where do you want to go?</p>
    
  <nav>
      <a href="terrace">Terrace</a><br>
  </nav>
</body>
</html>
